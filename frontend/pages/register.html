<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Register - Healthcare Scheduling System</title>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&family=Open+Sans:wght@300;400;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="../css/style.css">
</head>
<body>
  <!-- Header Section -->
  <header class="header">
    <div class="container">
      <nav class="navbar">
        <a href="../index.html" class="logo">MedSchedule</a>
        <ul class="nav-links" id="nav-links">
          <li><a href="../index.html">Home</a></li>
          <li><a href="doctors.html">Doctors</a></li>
          <li><a href="appointments.html">Appointments</a></li>
          <li id="admin-link" style="display: none;"><a href="admin/dashboard.html">Admin</a></li>
          <li id="auth-links">
            <a href="login.html" id="login-link">Login</a>
            <a href="register.html" id="register-link" class="active">Register</a>
            <a href="account.html" id="account-link" style="display: none;">My Account</a>
            <a href="#" id="logout-link" style="display: none;">Logout</a>
          </li>
        </ul>
      </nav>
    </div>
  </header>

  <!-- Registration Form Section -->
  <section class="register-section" style="padding: 60px 0;">
    <div class="container">
      <div class="form-container">
        <h2 class="form-title">Create an Account</h2>
        
        <!-- Alert for displaying messages -->
        <div id="alert-container" style="margin-bottom: 20px;"></div>
        
        <form id="register-form">
          <div class="form-group">
            <label for="name" class="form-label">Full Name</label>
            <input type="text" id="name" name="name" class="form-input" required>
            <div id="name-error" class="error-message" style="color: var(--error-color); display: none;"></div>
          </div>
          
          <div class="form-group">
            <label for="email" class="form-label">Email</label>
            <input type="email" id="email" name="email" class="form-input" required>
            <div id="email-error" class="error-message" style="color: var(--error-color); display: none;"></div>
          </div>
          
          <div class="form-group">
            <label for="password" class="form-label">Password</label>
            <input type="password" id="password" name="password" class="form-input" required>
            <div id="password-error" class="error-message" style="color: var(--error-color); display: none;"></div>
            <small style="color: #666; display: block; margin-top: 5px;">Password must be at least 8 characters with at least one letter and one number.</small>
          </div>
          
          <div class="form-group">
            <label for="confirm_password" class="form-label">Confirm Password</label>
            <input type="password" id="confirm_password" name="confirm_password" class="form-input" required>
            <div id="confirm_password-error" class="error-message" style="color: var(--error-color); display: none;"></div>
          </div>
          
          <div class="form-group">
            <label for="role" class="form-label">Register as</label>
            <select id="role" name="role" class="form-select" required>
              <option value="patient">Patient</option>
              <option value="doctor">Doctor</option>
            </select>
            <div id="role-error" class="error-message" style="color: var(--error-color); display: none;"></div>
          </div>
          
          <!-- Doctor-specific fields (hidden by default) -->
          <div id="doctor-fields" style="display: none; border: 1px solid #eee; padding: 15px; margin-top: 20px; border-radius: var(--border-radius);">
            <h3 style="margin-top: 0;">Doctor Information</h3>
            
            <div class="form-group">
              <label for="specialization" class="form-label">Specialization</label>
              <select id="specialization" name="specialization" class="form-select">
                <option value="">Select Specialization</option>
                <option value="Cardiology">Cardiology</option>
                <option value="Dermatology">Dermatology</option>
                <option value="Endocrinology">Endocrinology</option>
                <option value="Gastroenterology">Gastroenterology</option>
                <option value="Neurology">Neurology</option>
                <option value="Obstetrics">Obstetrics</option>
                <option value="Oncology">Oncology</option>
                <option value="Ophthalmology">Ophthalmology</option>
                <option value="Orthopedics">Orthopedics</option>
                <option value="Pediatrics">Pediatrics</option>
                <option value="Psychiatry">Psychiatry</option>
                <option value="Urology">Urology</option>
              </select>
              <div id="specialization-error" class="error-message" style="color: var(--error-color); display: none;"></div>
            </div>
            
            <div class="form-group">
              <label for="license_number" class="form-label">License Number</label>
              <input type="text" id="license_number" name="license_number" class="form-input">
              <div id="license_number-error" class="error-message" style="color: var(--error-color); display: none;"></div>
            </div>
            
            <div class="form-group">
              <label for="experience" class="form-label">Years of Experience</label>
              <input type="number" id="experience" name="experience" class="form-input" min="0" max="70">
              <div id="experience-error" class="error-message" style="color: var(--error-color); display: none;"></div>
            </div>
          </div>
          
          <!-- Patient-specific fields -->
          <div id="patient-fields" style="border: 1px solid #eee; padding: 15px; margin-top: 20px; border-radius: var(--border-radius);">
            <h3 style="margin-top: 0;">Patient Information</h3>
            
            <div class="form-group">
              <label for="date_of_birth" class="form-label">Date of Birth</label>
              <input type="date" id="date_of_birth" name="date_of_birth" class="form-input">
              <div id="date_of_birth-error" class="error-message" style="color: var(--error-color); display: none;"></div>
            </div>
            
            <div class="form-group">
              <label for="gender" class="form-label">Gender</label>
              <select id="gender" name="gender" class="form-select">
                <option value="">Select Gender</option>
                <option value="Male">Male</option>
                <option value="Female">Female</option>
                <option value="Other">Other</option>
              </select>
              <div id="gender-error" class="error-message" style="color: var(--error-color); display: none;"></div>
            </div>

            <div class="form-group">
              <label for="blood_group" class="form-label">Blood Group</label>
              <select id="blood_group" name="blood_group" class="form-select">
                <option value="Unknown">Unknown</option>
                <option value="A+">A+</option>
                <option value="A-">A-</option>
                <option value="B+">B+</option>
                <option value="B-">B-</option>
                <option value="AB+">AB+</option>
                <option value="AB-">AB-</option>
                <option value="O+">O+</option>
                <option value="O-">O-</option>
              </select>
            </div>
            
            <div class="form-group">
              <label for="phone" class="form-label">Phone Number</label>
              <input type="tel" id="phone" name="phone" class="form-input">
              <div id="phone-error" class="error-message" style="color: var(--error-color); display: none;"></div>
            </div>

            <div class="form-group">
              <label for="address" class="form-label">Address</label>
              <textarea id="address" name="address" class="form-input" rows="2"></textarea>
            </div>

            <div class="form-group">
              <label for="emergency_contact_name" class="form-label">Emergency Contact Name</label>
              <input type="text" id="emergency_contact_name" name="emergency_contact_name" class="form-input">
            </div>

            <div class="form-group">
              <label for="emergency_contact_relation" class="form-label">Relationship</label>
              <input type="text" id="emergency_contact_relation" name="emergency_contact_relation" class="form-input" placeholder="e.g., Spouse, Parent, Friend">
            </div>

            <div class="form-group">
              <label for="emergency_contact_phone" class="form-label">Emergency Contact Phone</label>
              <input type="tel" id="emergency_contact_phone" name="emergency_contact_phone" class="form-input">
            </div>

            <div class="form-group">
              <label for="allergies" class="form-label">Allergies (optional)</label>
              <textarea id="allergies" name="allergies" class="form-input" rows="2" placeholder="Enter any allergies separated by commas"></textarea>
            </div>
          </div>
          
          <div class="form-group" style="margin-top: 20px;">
            <label class="form-checkbox">
              <input type="checkbox" id="terms" name="terms" required>
              <span style="margin-left: 10px;">I agree to the <a href="#" style="color: var(--primary-color);">Terms & Conditions</a> and <a href="#" style="color: var(--primary-color);">Privacy Policy</a></span>
            </label>
            <div id="terms-error" class="error-message" style="color: var(--error-color); display: none;"></div>
          </div>
          
          <button type="submit" class="btn" style="width: 100%; margin-top: 10px;">Register</button>
          
          <div style="text-align: center; margin-top: 20px;">
            Already have an account? <a href="login.html" style="text-decoration: none; color: var(--primary-color);">Login</a>
          </div>
        </form>
      </div>
    </div>
  </section>

  <!-- Footer Section -->
  <footer style="background-color: #333; color: white; padding: 40px 0; margin-top: 60px;">
    <div class="container">
      <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 30px;">
        <div>
          <h3>MedSchedule</h3>
          <p>Efficient healthcare scheduling for better patient care and provider management.</p>
        </div>
        
        <div>
          <h3>Quick Links</h3>
          <ul style="list-style: none; padding: 0;">
            <li><a href="../index.html" style="color: white; text-decoration: none;">Home</a></li>
            <li><a href="doctors.html" style="color: white; text-decoration: none;">Doctors</a></li>
            <li><a href="appointments.html" style="color: white; text-decoration: none;">Appointments</a></li>
            <li><a href="login.html" style="color: white; text-decoration: none;">Login</a></li>
          </ul>
        </div>
        
        <div>
          <h3>Contact Us</h3>
          <p>Email: support@medschedule.com</p>
          <p>Phone: 1-800-MED-SCHED</p>
          <p>Address: 123 Healthcare Ave, Medical District</p>
        </div>
      </div>
      
      <div style="margin-top: 40px; text-align: center; padding-top: 20px; border-top: 1px solid rgba(255,255,255,0.1);">
        <p>&copy; 2023 Healthcare Scheduling System. All rights reserved.</p>
      </div>
    </div>
  </footer>

  <!-- Scripts -->
  <script src="../js/api.js"></script>
  <script src="../js/utils.js"></script>
  <script src="../js/layout.js"></script>
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      // Redirect if already logged in
      if (utils.isAuthenticated()) {
        window.location.href = '../index.html';
        return;
      }
      
      // Role selection toggle fields
      const roleSelect = document.getElementById('role');
      const doctorFields = document.getElementById('doctor-fields');
      const patientFields = document.getElementById('patient-fields');
      
      roleSelect.addEventListener('change', () => {
        if (roleSelect.value === 'doctor') {
          doctorFields.style.display = 'block';
          patientFields.style.display = 'none';
        } else {
          doctorFields.style.display = 'none';
          patientFields.style.display = 'block';
        }
      });
      
      // Registration form submission
      const registerForm = document.getElementById('register-form');
      registerForm.addEventListener('submit', async (e) => {
        e.preventDefault();
        
        // Clear previous errors
        utils.clearValidationErrors('register-form');
        
        // Get form data
        const name = document.getElementById('name').value.trim();
        const email = document.getElementById('email').value.trim();
        const password = document.getElementById('password').value.trim();
        const confirmPassword = document.getElementById('confirm_password').value.trim();
        const role = document.getElementById('role').value;
        const termsChecked = document.getElementById('terms').checked;
        
        // Basic validation
        const validations = {
          name: {
            label: 'Name',
            required: true
          },
          email: {
            label: 'Email',
            required: true,
            email: true
          },
          password: {
            label: 'Password',
            required: true,
            password: true
          },
          confirm_password: {
            label: 'Confirm Password',
            required: true,
            validator: (value) => {
              return value === password || 'Passwords do not match';
            }
          },
          role: {
            label: 'Role',
            required: true
          },
          terms: {
            label: 'Terms & Conditions',
            validator: () => {
              return termsChecked || 'You must agree to the Terms & Conditions';
            }
          }
        };
        
        // Add role-specific validations
        if (role === 'doctor') {
          validations.specialization = {
            label: 'Specialization',
            required: true
          };
          validations.license_number = {
            label: 'License Number',
            required: true
          };
        } else {
          validations.date_of_birth = {
            label: 'Date of Birth',
            required: true
          };
          validations.gender = {
            label: 'Gender',
            required: true
          };
          validations.phone = {
            label: 'Phone Number',
            required: true
          };
          validations.emergency_contact_name = {
            label: 'Emergency Contact Name',
            required: true
          };
          validations.emergency_contact_relation = {
            label: 'Emergency Contact Relationship',
            required: true
          };
          validations.emergency_contact_phone = {
            label: 'Emergency Contact Phone',
            required: true
          };
          validations.address = {
            label: 'Address',
            required: true
          };
        }
        
        const validationResult = utils.validateForm('register-form', validations);
        if (validationResult !== true) {
          return;
        }
        
        // Show loading state
        const submitButton = registerForm.querySelector('button[type="submit"]');
        const originalButtonText = submitButton.textContent;
        submitButton.textContent = 'Registering...';
        submitButton.disabled = true;
        
        try {
          // Prepare user data
          const userData = {
            name,
            email,
            password,
            role
          };
          
          // Add role-specific data
          if (role === 'doctor') {
            userData.specialization = document.getElementById('specialization').value;
            userData.licenseNumber = document.getElementById('license_number').value;
            userData.experience = parseInt(document.getElementById('experience').value) || 0;
            userData.fees = 100; // Default consultation fee
            userData.qualifications = ['M.D.']; // Default qualification
            userData.phone = document.getElementById('phone') ? document.getElementById('phone').value : '';
            userData.address = ''; // Default empty address
          } else {
            userData.patientInfo = {
              dateOfBirth: document.getElementById('date_of_birth').value,
              gender: document.getElementById('gender').value,
              bloodGroup: document.getElementById('blood_group').value,
              allergies: document.getElementById('allergies').value ? document.getElementById('allergies').value.split(',').map(item => item.trim()) : [],
              contactInfo: {
                phone: document.getElementById('phone').value,
                address: document.getElementById('address').value
              },
              emergencyContact: {
                name: document.getElementById('emergency_contact_name').value,
                relation: document.getElementById('emergency_contact_relation').value,
                phone: document.getElementById('emergency_contact_phone').value
              }
            };
          }
          
          // Call register API
          const response = await api.auth.register(userData);
          
          if (response.success) {
            // Show success message
            utils.showAlert('Registration successful! Redirecting...', 'success');
            
            // Fetch current user to get role information
            try {
              const userResponse = await api.auth.getCurrentUser();
              console.log('User data:', userResponse.data);
              // Role will be stored in localStorage by getCurrentUser method
            } catch (error) {
              console.error('Error fetching user data:', error);
            }
            
            // Redirect to index page
            setTimeout(() => {
              window.location.href = '../index.html';
            }, 1500);
          } else {
            // Show error message
            utils.showAlert(response.error || 'Registration failed. Please try again.', 'error');
          }
        } catch (error) {
          // Show error message
          utils.showAlert(error || 'Registration failed. Please try again.', 'error');
        } finally {
          // Reset button state
          submitButton.textContent = originalButtonText;
          submitButton.disabled = false;
        }
      });
    });
  </script>
</body>
</html> 